#!/bin/bash

# This script only takes Linux into account.

# Update submodules
git submodule update --init --recursive

# Install uWebsockets
cd thirdparty/uWebSockets
echo "Building uWebSockets..."
make || exit
echo "You will now be prompted for your password..."
sudo make install || exit
echo "Installed uWebSockets!"

cd ../..

# Install libsodium
cd thirdparty/libsodium
echo "Building libsodium..."
./autogen.sh || exit
./configure || exit
make check || exit
sudo make install || exit
sudo ldconfig
echo "Installed libsodium!"

cd ../..

# # Install libzmq
cd thirdparty/libzmq 
echo "Building libzmq..."
./autogen.sh || exit 
./configure --with-libsodium || exit
make CXXFLAGS="-DZMQ_BUILD_DRAFT_API=1" || exit
sudo make install CXXFLAGS="-DZMQ_BUILD_DRAFT_API=1" || exit
sudo ldconfig
echo "Installed libzmq!"

cd ../..

# Install ZMQPP
cd thirdparty/zmqpp
echo "Building zmqpp..."
make CXXFLAGS="-DZMQ_BUILD_DRAFT_API=1" || exit
sudo make install CXXFLAGS="-DZMQ_BUILD_DRAFT_API=1" || exit
echo "Installed zmqpp!"

cd ../..